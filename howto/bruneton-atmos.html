<!DOCTYPE html>
<html>
<head><link rel="stylesheet" href="index.css"/></head>
<body>
<div id="ui"></div>
<h1>Atmospheres</h1>
<p>Work in progress.
<p>Integrating <a href="https://github.com/ebruneton/precomputed_atmospheric_scattering">Eric
Brunetons atmosphere shaders</a>.  Check out the amazing work he was
part of
at <a href="http://proland.inrialpes.fr/skies.html">Proland</a>
<p>This will involve integrating THREE JS shaders with Eric's.  I'm
learning about webgl programming
at <a href="https://github.com/ebruneton/precomputed_atmospheric_scattering">WegGL
Fundamentals</a>.

<script type="module">
  import * as THREE from './js/lib/three.js/three.module.js';
  import TrackballControls from './js/lib/three.js/TrackballControls.js';
  import Atmosphere from './atmos/bruneton/atmosphere.js';
  import Loader from './js/loader.js';
  import Planet from './js/Planet.js';
  import Reify from './js/reify.js';
  import * as Shared from './js/shared.js';

  const container = document.getElementById('ui');
  const renderer = new THREE.WebGLRenderer({antialias: true});
  //renderer.autoClear = false;
  if (!renderer.capabilities.isWebGL2) {
    console.error('Need WebGL2 for good atmosphere');
  }
  console.log('Renderer capabilities:',  renderer.capabilities);
  renderer.setClearColor(0xff0000, 1);
  renderer.setSize(600, 600);
  container.appendChild(renderer.domElement);

  const camera = new THREE.PerspectiveCamera(Shared.INITIAL_FOV, 1, 1E-3, 1E35);
  camera.position.z = 10;
  const controls = new TrackballControls(camera, container);
  controls.target = camera.position;

  const scene = new THREE.Scene;
  const light = new THREE.DirectionalLight();
  const dist = 1e7;
  light.position.set(dist, 0, dist);
  camera.add(light);

  scene.add(new THREE.AxesHelper(1.1));

  const atmos = new Atmosphere(container, 'canvas', renderer.getContext());
  window.atmos = atmos;
  const onRender = () => {
    renderer.render(scene, camera);
    atmos.onRender();
    requestAnimationFrame(onRender);
  };
  window.onRender = onRender;
  requestAnimationFrame(onRender);
</script>
</body>
</html>
